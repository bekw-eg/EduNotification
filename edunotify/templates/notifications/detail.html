{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
        <div>
            <h2 class="card-title">
                {{ notification.title }}
                {% if notification.is_important %}
                    <span class="badge badge-danger" style="background-color: #dc3545; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px;">
                        üö® –ú–∞“£—ã–∑–¥—ã
                    </span>
                {% endif %}
                {% if notification.is_archived %}
                    <span class="badge badge-secondary" style="background-color: #6c757d; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px;">
                        üìÅ –ê—Ä—Ö–∏–≤—Ç–µ–ª–≥–µ–Ω
                    </span>
                {% endif %}
            </h2>
            <div class="notification-meta">
                <span><strong>–ö“Ø–Ω—ñ:</strong> {{ notification.created_at|date:"d.m.Y H:i" }}</span>
                <span class="notification-badge {% if notification.notification_type == 'general' %}badge-general{% else %}badge-group{% endif %}" 
                      style="margin: 0 10px;">
                    {{ notification.get_notification_type_display }}
                </span>
                {% if notification.group %}
                    <span><strong>–ì—Ä—É–ø–ø–∞:</strong> {{ notification.group.name }}</span>
                {% endif %}
                <span><strong>“ö“±—Ä—É—à—ã:</strong> {{ notification.created_by.username }}</span>
                {% if notification.is_archived %}
                    <span><strong>–ê—Ä—Ö–∏–≤—Ç–µ–ª–≥–µ–Ω:</strong> {{ notification.archive_date|date:"d.m.Y H:i" }}</span>
                {% endif %}
            </div>
        </div>
        
        <div style="display: flex; gap: 10px;">
            {% if user.role == 'admin' or user == notification.created_by %}
                {% if notification.is_active %}
                    <a href="{% url 'edit_notification' notification.id %}" class="btn btn-secondary">–¢“Ø–∑–µ—Ç—É</a>
                    <form method="POST" action="{% url 'archive_notification' notification.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-warning" 
                                onclick="return confirm('–•–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É–¥—ã –∞—Ä—Ö–∏–≤–∫–µ –∞—É—ã—Å—Ç—ã—Ä—É“ì–∞ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')">
                            üìÅ –ê—Ä—Ö–∏–≤–∫–µ
                        </button>
                    </form>
                {% else %}
                    <form method="POST" action="{% url 'restore_notification' notification.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">
                            ‚Ü©Ô∏è “ö–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—É
                        </button>
                    </form>
                {% endif %}
            {% endif %}
            <a href="{% url 'notifications' %}" class="btn btn-secondary">–ê—Ä—Ç“õ–∞</a>
        </div>
    </div>
    
    {% if notification.has_image %}
    <div style="margin-bottom: 30px; text-align: center;">
        <img src="{{ notification.image.url }}" alt="{{ notification.title }}" 
             class="img-fluid" style="max-width: 100%; max-height: 500px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <p class="text-muted mt-2" style="font-size: 14px;">–•–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É —Å—É—Ä–µ—Ç—ñ</p>
    </div>
    {% endif %}
    
    <div style="background-color: #f8f9fa; padding: 30px; border-radius: 8px; margin-bottom: 30px;">
        <div style="font-size: 16px; line-height: 1.8; color: #333;">
            {{ notification.content|linebreaks }}
        </div>
    </div>
    
    <div class="row">
        <div class="col-6">
            <div class="card" style="background-color: #f8f9fa;">
                <h4 style="color: #0066cc; margin-bottom: 15px;">–•–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É —Ç—É—Ä–∞–ª—ã –∞“õ–ø–∞—Ä–∞—Ç</h4>
                <div style="line-height: 2;">
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> 
                        {% if notification.is_active %}
                            <span style="color: #28a745;">‚óè –ë–µ–ª—Å–µ–Ω–¥—ñ</span>
                        {% elif notification.is_archived %}
                            <span style="color: #6c757d;">‚óè –ê—Ä—Ö–∏–≤—Ç–µ–ª–≥–µ–Ω</span>
                        {% else %}
                            <span style="color: #dc3545;">‚óè –ñ–æ–π—ã–ª“ì–∞–Ω</span>
                        {% endif %}
                    </p>
                    <p><strong>–¢“Ø—Ä—ñ:</strong> {{ notification.get_notification_type_display }}</p>
                    <p><strong>“ö“±—Ä—ã–ª“ì–∞–Ω —É–∞“õ—ã—Ç—ã:</strong> {{ notification.created_at|date:"d.m.Y H:i" }}</p>
                    <p><strong>–°–æ“£“ì—ã ”©–∑–≥–µ—Ä—Ç—ñ–ª–≥–µ–Ω:</strong> {{ notification.updated_at|date:"d.m.Y H:i"|default:"”®–∑–≥–µ—Ä—Ç—ñ–ª–º–µ–≥–µ–Ω" }}</p>
                    <p><strong>“ö“±—Ä—É—à—ã:</strong> {{ notification.created_by.get_full_name|default:notification.created_by.username }}</p>
                    {% if notification.group %}
                        <p><strong>–ì—Ä—É–ø–ø–∞:</strong> {{ notification.group.name }}</p>
                    {% endif %}
                    {% if notification.is_important %}
                        <p><strong>–ú–∞“£—ã–∑–¥—ã–ª—ã“ì—ã:</strong> –ò”ô (–±–∞—Ä–ª—ã“õ –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä“ì–∞ –µ—Å–∫–µ—Ä—Ç—É)</p>
                    {% endif %}
                    {% if notification.has_image %}
                        <p><strong>–°—É—Ä–µ—Ç –±–∞—Ä:</strong> –ò”ô</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-6">
            <div class="card" style="background-color: #f8f9fa;">
                <h4 style="color: #0066cc; margin-bottom: 15px;">”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</h4>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <a href="{% url 'notifications' %}" class="btn btn-secondary">
                        –ë–∞—Ä–ª—ã“õ —Ö–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É–ª–∞—Ä“ì–∞ –æ—Ä–∞–ª—É
                    </a>
                    
                    {% if user.role == 'admin' or user == notification.created_by %}
                        {% if notification.is_active %}
                            <a href="{% url 'edit_notification' notification.id %}" class="btn btn-primary">
                                ‚úèÔ∏è –•–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É–¥—ã —Ç“Ø–∑–µ—Ç—É
                            </a>
                        {% endif %}
                        
                        {% if notification.is_active %}
                            <form method="POST" action="{% url 'archive_notification' notification.id %}" 
                                  onsubmit="return confirmArchive()" style="display: block;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-warning" style="width: 100%;">
                                    üìÅ –ê—Ä—Ö–∏–≤–∫–µ –∞—É—ã—Å—Ç—ã—Ä—É
                                </button>
                            </form>
                        {% else %}
                            <form method="POST" action="{% url 'restore_notification' notification.id %}" 
                                  onsubmit="return confirm('–•–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É–¥—ã “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—É–≥–µ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')" 
                                  style="display: block;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success" style="width: 100%;">
                                    ‚Ü©Ô∏è –ê—Ä—Ö–∏–≤—Ç–µ–Ω “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—É
                                </button>
                            </form>
                        {% endif %}
                    {% endif %}
                    
                    {% if user.role == 'admin' %}
                        <form method="POST" action="{% url 'delete_notification' notification.id %}" 
                              onsubmit="return confirm('–•–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É–¥—ã —Ç–æ–ª—ã“õ –∂–æ—é“ì–∞ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')" 
                              style="display: block;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger" style="width: 100%;">
                                üóëÔ∏è –¢–æ–ª—ã“õ –∂–æ—é
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function confirmArchive() {
    const reason = prompt('–ê—Ä—Ö–∏–≤—Ç–µ—É —Å–µ–±–µ–±—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑ (–º—ñ–Ω–¥–µ—Ç—Ç—ñ –µ–º–µ—Å):');
    if (reason !== null) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = "{% url 'archive_notification' notification.id %}";
        
        const csrf = document.createElement('input');
        csrf.type = 'hidden';
        csrf.name = 'csrfmiddlewaretoken';
        csrf.value = '{{ csrf_token }}';
        form.appendChild(csrf);
        
        const reasonInput = document.createElement('input');
        reasonInput.type = 'hidden';
        reasonInput.name = 'reason';
        reasonInput.value = reason;
        form.appendChild(reasonInput);
        
        document.body.appendChild(form);
        form.submit();
        return false;
    }
    return false;
}
</script>
{% endblock %}